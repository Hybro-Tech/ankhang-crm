<%# Shared Pagination Partial - UI/UX ProMax Compliant %>
<%# Locals: collection, entry_name (optional) %>

<% if collection.respond_to?(:total_pages) && collection.total_count > 0 %>
<div class="px-6 py-4 border-t border-gray-200 flex flex-col sm:flex-row items-center justify-between gap-4 bg-gray-50/50">
  <%# Left: Per page selector + Count info %>
  <div class="flex items-center gap-3 text-sm text-gray-600">
    <div class="flex items-center gap-2">
      <label for="per_page_select" class="text-gray-500">Hiển thị</label>
      <select id="per_page_select"
              name="per_page" 
              class="border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-brand-blue focus:border-brand-blue py-1.5 pl-3 pr-8 bg-white cursor-pointer transition-colors"
              onchange="const url = new URL(window.location.href); url.searchParams.set('per_page', this.value); url.searchParams.set('page', 1); window.location.href = url.toString();">
        <% [10, 25, 50, 100].each do |count| %>
          <option value="<%= count %>" <%= "selected" if (params[:per_page] || 10).to_i == count %>>
            <%= count %>
          </option>
        <% end %>
      </select>
    </div>
    <span class="text-gray-400">|</span>
    <span>
      <span class="font-medium text-gray-900"><%= collection.offset_value + 1 %></span>
      <span class="text-gray-400">–</span>
      <span class="font-medium text-gray-900"><%= [collection.offset_value + collection.length, collection.total_count].min %></span>
      <span class="text-gray-400">/</span>
      <span class="font-medium text-gray-900"><%= collection.total_count %></span>
      <span><%= local_assigns[:entry_name] || "bản ghi" %></span>
    </span>
  </div>

  <%# Right: Page controls %>
  <% if collection.total_pages > 1 %>
  <nav class="flex items-center gap-1" aria-label="Pagination">
    <%# First page %>
    <% if collection.current_page > 2 %>
      <%= link_to url_for(page: 1, per_page: params[:per_page]), 
          class: "p-2 text-sm text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg transition-colors",
          title: "Trang đầu" do %>
        <i class="fa-solid fa-angles-left"></i>
      <% end %>
    <% end %>

    <%# Previous page %>
    <% if collection.first_page? %>
      <span class="p-2 text-gray-300 cursor-not-allowed">
        <i class="fa-solid fa-chevron-left"></i>
      </span>
    <% else %>
      <%= link_to url_for(page: collection.prev_page, per_page: params[:per_page]), 
          class: "p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg transition-colors",
          title: "Trang trước" do %>
        <i class="fa-solid fa-chevron-left"></i>
      <% end %>
    <% end %>

    <%# Page numbers %>
    <div class="flex items-center gap-1 mx-2">
      <% window = 2 %>
      <% start_page = [1, collection.current_page - window].max %>
      <% end_page = [collection.total_pages, collection.current_page + window].min %>
      
      <% if start_page > 1 %>
        <%= link_to 1, url_for(page: 1, per_page: params[:per_page]), 
            class: "min-w-[36px] h-9 flex items-center justify-center text-sm text-gray-700 hover:bg-gray-100 rounded-lg transition-colors" %>
        <% if start_page > 2 %>
          <span class="text-gray-400 px-1">…</span>
        <% end %>
      <% end %>

      <% (start_page..end_page).each do |page| %>
        <% if page == collection.current_page %>
          <span class="min-w-[36px] h-9 flex items-center justify-center text-sm font-medium text-white bg-brand-blue rounded-lg shadow-sm">
            <%= page %>
          </span>
        <% else %>
          <%= link_to page, url_for(page: page, per_page: params[:per_page]), 
              class: "min-w-[36px] h-9 flex items-center justify-center text-sm text-gray-700 hover:bg-gray-100 rounded-lg transition-colors" %>
        <% end %>
      <% end %>

      <% if end_page < collection.total_pages %>
        <% if end_page < collection.total_pages - 1 %>
          <span class="text-gray-400 px-1">…</span>
        <% end %>
        <%= link_to collection.total_pages, url_for(page: collection.total_pages, per_page: params[:per_page]), 
            class: "min-w-[36px] h-9 flex items-center justify-center text-sm text-gray-700 hover:bg-gray-100 rounded-lg transition-colors" %>
      <% end %>
    </div>

    <%# Next page %>
    <% if collection.last_page? %>
      <span class="p-2 text-gray-300 cursor-not-allowed">
        <i class="fa-solid fa-chevron-right"></i>
      </span>
    <% else %>
      <%= link_to url_for(page: collection.next_page, per_page: params[:per_page]), 
          class: "p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg transition-colors",
          title: "Trang tiếp" do %>
        <i class="fa-solid fa-chevron-right"></i>
      <% end %>
    <% end %>

    <%# Last page %>
    <% if collection.current_page < collection.total_pages - 1 %>
      <%= link_to url_for(page: collection.total_pages, per_page: params[:per_page]), 
          class: "p-2 text-sm text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg transition-colors",
          title: "Trang cuối" do %>
        <i class="fa-solid fa-angles-right"></i>
      <% end %>
    <% end %>
  </nav>
  <% end %>
</div>
<% end %>
