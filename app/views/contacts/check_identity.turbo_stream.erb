<%= turbo_stream.update "context_panel_content" do %>
  <% if @contact %>
    <!-- Found Contact -->
    <div class="bg-blue-50/50 p-4 min-h-full">
      <div class="flex items-start justify-between mb-4">
        <div>
           <span class="inline-block px-2 py-1 bg-green-100 text-green-700 text-xs font-bold rounded mb-1">
             <%= @contact.status_label %>
           </span>
           <h3 class="text-lg font-bold text-gray-900"><%= @contact.name %></h3>
           <p class="text-sm text-gray-500 font-mono"><%= @contact.code %></p>
        </div>
        <%= link_to contact_path(@contact), target: "_blank", class: "text-brand-blue hover:text-blue-700" do %>
          <i class="fa-solid fa-external-link-alt"></i>
        <% end %>
      </div>

      <div class="space-y-4 bg-white p-4 rounded-lg shadow-sm border border-blue-100">
        <!-- Contact Info -->
        <div class="grid grid-cols-2 gap-4 text-sm">
           <div>
             <p class="text-gray-500 text-xs uppercase">Người phụ trách</p>
             <p class="font-medium text-gray-800"><%= @contact.assigned_user&.name || "Chưa phân công" %></p>
           </div>
           <div>
             <p class="text-gray-500 text-xs uppercase">Nguồn</p>
             <p class="font-medium text-gray-800"><%= @contact.source_label %></p>
           </div>
           
           <% if @contact.phone.present? %>
             <div class="col-span-2">
                <p class="text-gray-500 text-xs uppercase">Điện thoại</p>
                <p class="font-mono font-bold text-gray-800"><%= @contact.phone %></p>
             </div>
           <% end %>
           
           <% if @contact.zalo_id.present? %>
             <div class="col-span-2">
                <p class="text-gray-500 text-xs uppercase">Zalo ID</p>
                <p class="font-bold text-blue-600"><%= @contact.zalo_id %></p>
             </div>
           <% end %>
        </div>

        <% if @contact.notes.present? %>
          <div class="pt-3 border-t border-gray-100">
            <p class="text-gray-500 text-xs uppercase mb-1">Ghi chú gần nhất</p>
            <p class="text-sm text-gray-600 italic">"<%= @contact.notes.truncate(100) %>"</p>
          </div>
        <% end %>
      </div>
      
      <div class="mt-6 text-center">
         <p class="text-xs text-gray-400 mb-2">Đã tồn tại trong hệ thống</p>
         <%= link_to "Xem chi tiết hồ sơ", contact_path(@contact), target: "_blank", class: "inline-block px-4 py-2 bg-white border border-gray-300 rounded text-sm text-gray-700 font-medium hover:bg-gray-50 shadow-sm" %>
      </div>
    </div>

  <% else %>
    <!-- Not Found: Show 'Available' State -->
    <div class="p-8 text-center min-h-full flex flex-col items-center justify-center">
      <div class="w-16 h-16 bg-blue-50 rounded-full flex items-center justify-center mb-4">
        <i class="fa-solid fa-user-plus text-2xl text-brand-blue"></i>
      </div>
      <h3 class="text-brand-blue font-bold text-lg mb-1">Khách hàng mới</h3>
      <p class="text-sm text-gray-500 mb-4">
        Thông tin <span class="font-mono font-bold text-gray-800"><%= @identity_value %></span> chưa có trong hệ thống.
      </p>
      <div class="inline-flex items-center text-green-600 text-xs font-bold bg-green-50 px-3 py-1 rounded-full">
         <i class="fa-solid fa-check mr-1"></i> Có thể thêm mới
      </div>
    </div>
  <% end %>
<% end %>
