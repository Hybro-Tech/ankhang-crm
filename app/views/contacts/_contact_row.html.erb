<%# TASK-035: Contact Row Partial for Turbo Streams %>
<%# Used by: contacts/index.html.erb and real-time broadcasts %>

<tr class="hover:bg-gray-50 transition-colors" id="<%= dom_id(contact) %>">
  <td class="px-6 py-4 whitespace-nowrap">
    <%= link_to contact, class: "text-sm font-medium text-brand-blue hover:underline", data: { turbo_frame: "_top" } do %>
      <%= contact.code %>
    <% end %>
  </td>
  <td class="px-6 py-4 whitespace-nowrap">
    <div class="text-sm font-medium text-gray-900"><%= contact.name %></div>
    <% if contact.email.present? %>
      <div class="text-xs text-gray-500"><%= contact.email %></div>
    <% end %>
  </td>
  <td class="px-6 py-4 whitespace-nowrap">
    <a href="tel:<%= contact.phone %>" class="text-sm text-gray-900 hover:text-brand-blue">
      <%= contact.phone %>
    </a>
  </td>
  <td class="px-6 py-4 whitespace-nowrap">
    <% if contact.zalo_id.present? %>
      <div class="text-sm text-blue-600 font-medium"><%= contact.zalo_id %></div>
    <% elsif contact.zalo_link.present? %>
      <a href="<%= contact.zalo_link %>" target="_blank" class="text-blue-500 hover:text-blue-700">
        <i class="fa-solid fa-arrow-up-right-from-square"></i> Link
      </a>
    <% elsif contact.zalo_qr.attached? %>
      <span class="text-xs text-green-600"><i class="fa-solid fa-qrcode"></i> QR</span>
    <% else %>
      <span class="text-gray-400">-</span>
    <% end %>
  </td>
  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">
    <span class="text-gray-400">-</span>
  </td>
  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600"><%= contact.service_type&.name %></td>
  <td class="px-6 py-4 whitespace-nowrap">
    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium 
      <%= case contact.status
          when 'new_contact' then 'bg-blue-100 text-blue-800'
          when 'potential', 'potential_old' then 'bg-yellow-100 text-yellow-800'
          when 'in_progress' then 'bg-purple-100 text-purple-800'
          when 'closed_new', 'closed_old' then 'bg-green-100 text-green-800'
          when 'failed' then 'bg-red-100 text-red-800'
          when 'cskh_l1', 'cskh_l2' then 'bg-orange-100 text-orange-800'
          else 'bg-gray-100 text-gray-800'
          end %>">
      <%= contact.status_label %>
    </span>
  </td>
  <td class="px-6 py-4 whitespace-nowrap text-sm">
    <% if contact.assigned_user.present? %>
      <span class="text-gray-900"><%= contact.assigned_user.name %></span>
    <% else %>
      <span class="text-orange-600 font-medium">
        <i class="fa-solid fa-exclamation-circle mr-1"></i>Chưa gán
      </span>
    <% end %>
  </td>
  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
    <%= l(contact.created_at, format: :short) %>
  </td>
  <td class="px-6 py-4 whitespace-nowrap text-right text-sm">
    <div class="flex items-center justify-end gap-3">
      <%# Pick button - only for pickable contacts %>
      <% if can?(:pick, Contact) && contact.pickable? %>
        <%= button_to pick_contact_path(contact), 
            method: :post, 
            class: "text-green-600 hover:text-green-900 transition-colors",
            title: "Nhận khách này",
            data: { turbo_confirm: "Bạn có chắc muốn nhận khách #{contact.name}?" } do %>
          <i class="fa-solid fa-dollar-sign text-lg"></i>
        <% end %>
      <% end %>
      
      <%# View button %>
      <%= link_to contact, class: "text-gray-600 hover:text-gray-900 transition-colors", title: "Xem chi tiết", data: { turbo_frame: "_top" } do %>
        <i class="fa-solid fa-eye"></i>
      <% end %>
      
      <%# Edit button %>
      <% if can?(:edit, contact) %>
        <%= link_to edit_contact_path(contact), class: "text-brand-blue hover:text-blue-900 transition-colors", title: "Sửa", data: { turbo_frame: "_top" } do %>
          <i class="fa-solid fa-pen-to-square"></i>
        <% end %>
      <% end %>
    </div>
  </td>
</tr>
