<%# TASK-064: Status progress bar with 4 simplified statuses %>
<% 
  # Define steps with their statuses (simplified to 4)
  steps = [
    { key: "new_contact", label: "Mới", number: 1 },
    { key: "potential", label: "Tiềm năng", number: 2 },
    { key: "failed", label: "Thất bại", number: 3, is_failed: true },
    { key: "closed", label: "Đã chốt", number: 4 }
  ]
  
  # Map current status to step index
  current_status = contact.status
  current_step_index = case current_status
    when "new_contact" then 0
    when "potential" then 1
    when "failed" then 2
    when "closed" then 3
    else 0
  end
  
  is_failed = current_status == "failed"
%>

<div id="status_progress" class="bg-white px-6 py-4 border-b border-gray-200">
  <div class="flex items-center justify-between w-full max-w-3xl mx-auto">
    <% steps.each_with_index do |step, index| %>
      <%# Step circle %>
      <div class="flex items-center">
        <% if step[:is_failed] && is_failed %>
          <%# Failed step - show as failed %>
          <div class="flex items-center justify-center w-8 h-8 bg-red-500 text-white rounded-full font-bold shadow-lg ring-4 ring-red-50">
            <i class="fa-solid fa-times"></i>
          </div>
          <div class="ml-2 text-sm font-bold text-red-600"><%= step[:label] %></div>
        <% elsif step[:is_failed] && !is_failed %>
          <%# Failed step - not current, show as skipped/alternative path %>
          <div class="flex items-center justify-center w-8 h-8 bg-gray-100 text-gray-300 rounded-full font-bold">
            <i class="fa-solid fa-times text-xs"></i>
          </div>
          <div class="ml-2 text-sm font-medium text-gray-300"><%= step[:label] %></div>
        <% elsif index < current_step_index && !step[:is_failed] %>
          <%# Completed step %>
          <div class="flex items-center justify-center w-8 h-8 bg-blue-100 rounded-full text-brand-blue font-bold">
            <i class="fa-solid fa-check"></i>
          </div>
          <div class="ml-2 text-sm font-medium text-brand-blue"><%= step[:label] %></div>
        <% elsif index == current_step_index %>
          <%# Current step %>
          <div class="flex items-center justify-center w-8 h-8 bg-brand-blue text-white rounded-full font-bold shadow-lg ring-4 ring-blue-50">
            <%= step[:number] %>
          </div>
          <div class="ml-2 text-sm font-bold text-brand-blue"><%= step[:label] %></div>
        <% else %>
          <%# Pending step %>
          <div class="flex items-center justify-center w-8 h-8 bg-gray-100 text-gray-400 rounded-full font-bold">
            <%= step[:number] %>
          </div>
          <div class="ml-2 text-sm font-medium text-gray-400"><%= step[:label] %></div>
        <% end %>
      </div>
      
      <%# Connector line (not after last step) %>
      <% if index < steps.length - 1 %>
        <% if step[:is_failed] %>
          <%# Line after Failed - dashed if not failed %>
          <div class="flex-1 h-1 mx-4 rounded <%= is_failed ? 'bg-red-200' : 'bg-gray-200 border-dashed' %>"></div>
        <% else %>
          <div class="flex-1 h-1 mx-4 rounded <%= index < current_step_index && !is_failed ? 'bg-brand-blue' : 'bg-gray-200' %>"></div>
        <% end %>
      <% end %>
    <% end %>
  </div>
</div>
