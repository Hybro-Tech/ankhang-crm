<div class="flex items-center justify-between mb-6">
  <div>
    <h1 class="text-2xl font-bold text-gray-900">Danh sách đội nhóm</h1>
    <p class="text-sm text-gray-500 mt-1">Quản lý cấu trúc đội nhóm và phân công</p>
  </div>
  <% if can? :create, Team %>
    <%= link_to new_team_path, class: "bg-brand-blue text-white px-4 py-2 rounded-lg shadow hover:bg-blue-900 transition flex items-center" do %>
      <i class="fa-solid fa-plus mr-2"></i> Tạo đội mới
    <% end %>
  <% end %>
</div>

<div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
  <table class="min-w-full divide-y divide-gray-200">
    <thead class="bg-gray-50">
      <tr>
        <th class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">Đội nhóm</th>
        <th class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">Vùng / Miền</th>
        <th class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">Trưởng nhóm</th>
        <th class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">Thành viên</th>
        <th class="px-6 py-3 text-center text-xs font-bold text-gray-500 uppercase tracking-wider">Trạng thái</th>
        <th class="px-6 py-3 text-right text-xs font-bold text-gray-500 uppercase tracking-wider">Hành động</th>
      </tr>
    </thead>
    <tbody class="bg-white divide-y divide-gray-200">
      <% @teams.each do |team| %>
        <tr class="hover:bg-gray-50 transition-colors">
          <td class="px-6 py-4 whitespace-nowrap">
            <div class="text-sm font-bold text-gray-900"><%= team.name %></div>
            <div class="text-sm text-gray-500 line-clamp-1"><%= team.description %></div>
          </td>
          <td class="px-6 py-4 whitespace-nowrap">
            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-50 text-blue-700">
              <%= team.region.presence || "Chưa phân vùng" %>
            </span>
          </td>
          <td class="px-6 py-4 whitespace-nowrap">
            <% if team.manager %>
              <div class="flex items-center">
                <img src="https://ui-avatars.com/api/?name=<%= URI.encode_www_form_component(team.manager.name) %>&background=random" class="w-8 h-8 rounded-full border border-gray-200 mr-2">
                <span class="text-sm font-medium text-gray-900"><%= team.manager.name %></span>
              </div>
            <% else %>
              <span class="text-sm text-gray-400 italic">Chưa chỉ định</span>
            <% end %>
          </td>
          <td class="px-6 py-4 whitespace-nowrap">
            <div class="flex items-center">
              <span class="text-lg font-bold text-gray-700 mr-2"><%= team.users.count %></span>
              <span class="text-xs text-gray-500">nhân viên</span>
            </div>
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-center">
            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
              Hoạt động
            </span>
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
            <% if can? :edit, team %>
              <%= link_to edit_team_path(team), class: "text-[#0B387A] hover:text-blue-900 mr-3 inline-block", title: "Sửa" do %>
                <i class="fa-solid fa-pen-to-square"></i>
              <% end %>
            <% end %>
            <% if can? :destroy, team %>
              <% if team.users.empty? %>
                <%= button_to team_path(team), method: :delete, data: { turbo_confirm: "Bạn có chắc muốn xóa team này?" }, class: "text-red-600 hover:text-red-900 inline-block", form: { class: "inline-block" }, title: "Xóa" do %>
                  <i class="fa-solid fa-trash"></i>
                <% end %>
              <% else %>
                <span class="text-gray-300 cursor-not-allowed inline-block" title="Không thể xóa khi còn thành viên">
                  <i class="fa-solid fa-trash"></i>
                </span>
              <% end %>
            <% end %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
  <% if @teams.respond_to?(:total_pages) %>
    <%= render "shared/pagination", collection: @teams, entry_name: "đội nhóm" %>
  <% end %>
</div>

<% if @teams.empty? %>
  <div class="text-center py-12 bg-white rounded-xl border border-dashed border-gray-300 mt-6">
    <div class="text-gray-400 mb-3">
      <i class="fa-solid fa-users-slash text-5xl"></i>
    </div>
    <h3 class="text-lg font-medium text-gray-900">Chưa có đội nhóm nào</h3>
    <p class="text-gray-500 mt-1">Hãy tạo đội nhóm đầu tiên để bắt đầu quản lý nhân viên.</p>
    <% if can? :create, Team %>
      <div class="mt-6">
        <%= link_to new_team_path, class: "inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-brand-blue hover:bg-blue-900" do %>
          <i class="fa-solid fa-plus mr-2"></i> Tạo đội mới
        <% end %>
      </div>
    <% end %>
  </div>
<% end %>
