<%# Aftercare Tab - Chăm sóc sau bán %>
<turbo-frame id="contact_list_frame">
<div class="overflow-x-auto">
  <table class="min-w-full divide-y divide-gray-200">
    <thead class="bg-gray-50">
      <tr>
        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Khách hàng</th>
        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Dịch vụ</th>
        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Ngày chốt</th>
        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">CSKH phụ trách</th>
        <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase">Hành động</th>
      </tr>
    </thead>
    <tbody class="bg-white divide-y divide-gray-100">
      <% if contacts.any? %>
        <% contacts.each do |contact| %>
          <tr class="hover:bg-green-50 transition-colors">
            <td class="px-4 py-3 whitespace-nowrap">
              <div class="flex items-center">
                <div class="w-9 h-9 rounded-full bg-gradient-to-br from-green-500 to-green-600 flex items-center justify-center text-white text-sm font-bold mr-3">
                  <%= contact.name&.first&.upcase || "?" %>
                </div>
                <div>
                  <p class="text-sm font-medium text-gray-900"><%= contact.name %></p>
                  <p class="text-xs text-gray-400"><%= contact.phone %></p>
                </div>
              </div>
            </td>
            <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-600">
              <%= contact.service_type&.name || "N/A" %>
            </td>
            <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
              <%= contact.closed_at&.strftime("%d/%m/%Y") || "N/A" %>
            </td>
            <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-600">
              <%= contact.assigned_user&.name || "-" %>
            </td>
            <td class="px-4 py-3 whitespace-nowrap text-center">
              <%= link_to contact_path(contact), class: "inline-flex items-center px-2.5 py-1 text-xs font-medium rounded-lg border border-gray-300 text-gray-600 hover:bg-gray-100 transition-colors" do %>
                <i class="fa-solid fa-eye mr-1"></i> Xem
              <% end %>
            </td>
          </tr>
        <% end %>
      <% else %>
        <tr>
          <td colspan="5" class="px-4 py-12 text-center">
            <div class="text-gray-400">
              <i class="fa-solid fa-box-open text-3xl mb-2"></i>
              <p class="text-sm font-medium">Chưa có đơn chốt gần đây</p>
              <p class="text-xs">Đơn chốt trong 30 ngày qua sẽ hiển thị ở đây</p>
            </div>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>

<% if contacts.respond_to?(:total_pages) && contacts.total_pages > 1 %>
  <div class="px-4 py-3 border-t border-gray-100">
    <%= paginate contacts, theme: 'tailwind' %>
  </div>
<% end %>
</turbo-frame>
