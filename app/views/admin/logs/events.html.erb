<%# TASK-LOGGING: User Events View (Tier 2) %>
<div class="flex items-center justify-between mb-6">
  <div>
    <h1 class="text-2xl font-bold text-gray-900">User Events</h1>
    <p class="text-sm text-gray-500 mt-1">Theo dõi hoạt động người dùng (Tier 2)</p>
  </div>
  <div class="flex items-center space-x-3">
    <%= link_to admin_logs_path, class: "bg-gray-100 text-gray-600 px-4 py-2 rounded-lg text-sm font-medium hover:bg-gray-200 flex items-center cursor-pointer transition-colors duration-200" do %>
      <i class="fa-solid fa-list-check mr-2"></i> Activity Logs
    <% end %>
    <%= link_to events_admin_logs_path(format: :csv, **request.query_parameters), class: "bg-gray-100 text-gray-600 px-4 py-2 rounded-lg text-sm font-medium hover:bg-gray-200 flex items-center cursor-pointer transition-colors duration-200" do %>
      <i class="fa-solid fa-download mr-2"></i> Xuất CSV
    <% end %>
  </div>
</div>

<%# Filters %>
<%= form_with url: events_admin_logs_path, method: :get, class: "bg-white p-4 rounded-xl shadow-sm border border-gray-100 mb-6" do %>
  <div class="grid grid-cols-1 md:grid-cols-6 gap-4">
    <div>
      <label class="block text-xs font-medium text-gray-500 mb-1">Từ ngày</label>
      <%= date_field_tag :date_from, params[:date_from], class: "w-full border border-gray-300 rounded-lg px-3 py-2 text-sm outline-none focus:ring-1 focus:ring-brand-blue" %>
    </div>
    <div>
      <label class="block text-xs font-medium text-gray-500 mb-1">Đến ngày</label>
      <%= date_field_tag :date_to, params[:date_to], class: "w-full border border-gray-300 rounded-lg px-3 py-2 text-sm outline-none focus:ring-1 focus:ring-brand-blue" %>
    </div>
    <div>
      <label class="block text-xs font-medium text-gray-500 mb-1">Loại event</label>
      <%= select_tag :event_type, options_for_select(@event_types.map { |t| [t.titleize, t] }, params[:event_type]), include_blank: "Tất cả", class: "w-full border border-gray-300 rounded-lg px-3 py-2 text-sm outline-none bg-white" %>
    </div>
    <div>
      <label class="block text-xs font-medium text-gray-500 mb-1">Status</label>
      <%= select_tag :status, options_for_select([["2xx Success", "200"], ["4xx Client Error", "400"], ["5xx Server Error", "500"]], params[:status]), include_blank: "Tất cả", class: "w-full border border-gray-300 rounded-lg px-3 py-2 text-sm outline-none bg-white" %>
    </div>
    <div>
      <label class="block text-xs font-medium text-gray-500 mb-1">Path</label>
      <%= text_field_tag :path, params[:path], placeholder: "/contacts", class: "w-full border border-gray-300 rounded-lg px-3 py-2 text-sm outline-none focus:ring-1 focus:ring-brand-blue" %>
    </div>
    <div class="flex items-end">
      <%= submit_tag "Lọc", class: "w-full bg-brand-blue text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-blue-700 cursor-pointer" %>
    </div>
  </div>
<% end %>

<%# Stats %>
<div class="mb-4 text-sm text-gray-500">
  Hiển thị <%= @events.size %> trong tổng số <%= @events.total_count %> bản ghi
</div>

<%# Events Table %>
<div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden overflow-x-auto">
  <table class="min-w-full divide-y divide-gray-200">
    <thead class="bg-gray-50">
      <tr>
        <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase">Thời gian</th>
        <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase">User</th>
        <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase">Type</th>
        <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase">Method</th>
        <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase">Path</th>
        <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
        <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase">Duration</th>
        <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase">IP</th>
      </tr>
    </thead>
    <tbody class="bg-white divide-y divide-gray-200">
      <% @events.each do |event| %>
        <tr class="hover:bg-gray-50 transition-colors duration-150">
          <td class="px-3 py-3 whitespace-nowrap text-xs text-gray-500">
            <%= event.created_at.strftime("%d/%m %H:%M:%S") %>
          </td>
          <td class="px-3 py-3 whitespace-nowrap text-sm text-gray-900">
            <%= event.user&.name || "Guest" %>
          </td>
          <td class="px-3 py-3 whitespace-nowrap">
            <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium <%= event_type_class(event.event_type) %>">
              <%= event.event_type %>
            </span>
          </td>
          <td class="px-3 py-3 whitespace-nowrap">
            <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium <%= method_class(event.method) %>">
              <%= event.method %>
            </span>
          </td>
          <td class="px-3 py-3 text-xs text-gray-600 max-w-xs truncate" title="<%= event.path %>">
            <%= event.path.truncate(40) %>
          </td>
          <td class="px-3 py-3 whitespace-nowrap">
            <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium <%= status_class(event.response_status) %>">
              <%= event.response_status %>
            </span>
          </td>
          <td class="px-3 py-3 whitespace-nowrap text-xs text-gray-500">
            <%= event.duration_ms %>ms
          </td>
          <td class="px-3 py-3 whitespace-nowrap text-xs text-gray-500">
            <%= event.ip_address %>
          </td>
        </tr>
      <% end %>
      <% if @events.empty? %>
        <tr>
          <td colspan="8" class="px-4 py-8 text-center text-gray-500">
            Không có dữ liệu
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>

<%# Pagination %>
<div class="mt-4">
  <%= paginate @events %>
</div>
